name: Terragrunt Workflow

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Select the environment to deploy'
        required: true
        default: 'dev'
        type: choice
        options:
        - dev
        - qa 
        - load
      apply_this_plan:
        description: 'Do you want to apply this plan?'
        required: false
        type: boolean

env:
  SSH_PRIVATE_KEY: |
    -----BEGIN OPENSSH PRIVATE KEY-----
    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
    -----END OPENSSH PRIVATE KEY-----

jobs:
  terragrunt:
    permissions: write-all
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: ${{ github.event.inputs.environment }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name : git ssh
        uses: webfactory/ssh-agent@v0.7.0
        with:
            ssh-private-key: ${{ env.SSH_PRIVATE_KEY }}


      - name: git clone
        run: git clone 'git@github.com:zibroo/hackathonReact.git'

      # - name: Configure AWS credentials from AWS account
      #   uses: aws-actions/configure-aws-credentials@v1
      #   with:
      #     role-to-assume: arn:aws:iam::790285888667:role/actionsrole
      #     aws-region: us-east-1

      # - name: Setup Terraform v1.5.7
      #   uses: hashicorp/setup-Terraform@v1
      #   with:
      #     terraform_version: 1.5.7
      #     terraform_wrapper: true

      # - name: Setup Terragrunt v0.38.4
      #   run: |
      #     sudo wget -q -O /bin/terragrunt "https://github.com/gruntwork-io/terragrunt/releases/download/v0.50.14/terragrunt_linux_amd64"
      #     sudo chmod +x /bin/terragrunt
      #     terragrunt -v

      # - name: Initialize Terragrunt
      #   run: |
      #     terragrunt init

      # - name: Terragrunt Plan
      #   id: plan
      #   run: |
      #     terragrunt plan -out=tfplan

      # - name: Terragrunt Apply 
      #   if:  github.event.inputs.apply_this_plan  == 'true'
      #   run: |
      #     terragrunt apply -auto-approve tfplan

      # - name: Terragrunt Apply Not
      #   if:  github.event.inputs.apply_this_plan  == 'false'
      #   run: |
      #     echo "COMPLETE! THIS PLAN WAN NOT APPLY. IF YOU WANT TO APPLY THIS PLAN RERUN WORKFLOW WITH APPLY SETTING"