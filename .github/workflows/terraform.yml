name: Terragrunt Workflow

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Select the environment to deploy'
        required: true
        default: 'dev'
        type: choice
        options:
        - dev
        - qa 
        - load
      apply_this_plan:
        description: 'Do you want to apply this plan?'
        required: false
        type: boolean

env:
  SSH_PRIVATE_KEY: |
    -----BEGIN OPENSSH PRIVATE KEY-----
    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
    -----END OPENSSH PRIVATE KEY-----

jobs:
  terragrunt:
    permissions: write-all
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: ${{ github.event.inputs.environment }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name : git ssh
        uses: webfactory/ssh-agent@v0.7.0
        with:
            ssh-private-key: ${{ env.SSH_PRIVATE_KEY }}


      - name: git clone
        run: git clone 'git@github.com:zibroo/hackathonReact.git'

      # - name: Configure AWS credentials from AWS account
      #   uses: aws-actions/configure-aws-credentials@v1
      #   with:
      #     role-to-assume: arn:aws:iam::790285888667:role/actionsrole
      #     aws-region: us-east-1

      # - name: Setup Terraform v1.5.7
      #   uses: hashicorp/setup-Terraform@v1
      #   with:
      #     terraform_version: 1.5.7
      #     terraform_wrapper: true

      # - name: Setup Terragrunt v0.38.4
      #   run: |
      #     sudo wget -q -O /bin/terragrunt "https://github.com/gruntwork-io/terragrunt/releases/download/v0.50.14/terragrunt_linux_amd64"
      #     sudo chmod +x /bin/terragrunt
      #     terragrunt -v

      # - name: Initialize Terragrunt
      #   run: |
      #     terragrunt init

      # - name: Terragrunt Plan
      #   id: plan
      #   run: |
      #     terragrunt plan -out=tfplan

      # - name: Terragrunt Apply 
      #   if:  github.event.inputs.apply_this_plan  == 'true'
      #   run: |
      #     terragrunt apply -auto-approve tfplan

      # - name: Terragrunt Apply Not
      #   if:  github.event.inputs.apply_this_plan  == 'false'
      #   run: |
      #     echo "COMPLETE! THIS PLAN WAN NOT APPLY. IF YOU WANT TO APPLY THIS PLAN RERUN WORKFLOW WITH APPLY SETTING"